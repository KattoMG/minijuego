<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minijuego de Memoria Musical</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/phaser/3.55.2/phaser.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f0f0f0;
            font-family: Arial, sans-serif;
        }

        canvas {
            border: 2px solid #000;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }

        .phaser-text {
            font-family: Arial, sans-serif;
        }
    </style>
</head>
<body>
    <script>
        const config = {
            type: Phaser.AUTO,
            width: 800,
            height: 600,
            scene: {
                preload: preload,
                create: create,
                update: update
            }
        };

        const colors = ['red', 'green', 'blue', 'yellow'];
        let sequence = [];
        let playerSequence = [];
        let currentStep = 0;
        let isPlayerTurn = false;
        let isAnimating = false;
        let score = 0;
        let difficulty = 'medium';
        let intervalTime = 800;

        const game = new Phaser.Game(config);

      function preload() {
            this.load.audio('sound1', 'assets/audio/sound1.mp3');
            this.load.audio('sound2', 'assets/audio/sound2.mp3');
            this.load.audio('sound3', 'assets/audio/sound3.mp3');
            this.load.audio('sound4', 'assets/audio/sound4.mp3');
        }



        function create() {
            this.cameras.main.setBackgroundColor('#ffffff');

            // Create buttons
            this.redButton = this.add.rectangle(200, 300, 150, 150, 0xff0000).setInteractive();
            this.greenButton = this.add.rectangle(400, 300, 150, 150, 0x00ff00).setInteractive();
            this.blueButton = this.add.rectangle(600, 300, 150, 150, 0x0000ff).setInteractive();
            this.yellowButton = this.add.rectangle(400, 450, 150, 150, 0xffff00).setInteractive();

            this.redButton.on('pointerdown', () => handlePlayerInput.call(this, 'red'));
            this.greenButton.on('pointerdown', () => handlePlayerInput.call(this, 'green'));
            this.blueButton.on('pointerdown', () => handlePlayerInput.call(this, 'blue'));
            this.yellowButton.on('pointerdown', () => handlePlayerInput.call(this, 'yellow'));

            // Create text elements
            this.scoreText = this.add.text(10, 10, 'Puntuación: 0', { fontSize: '32px', fill: '#000' });
            this.difficultyText = this.add.text(10, 50, 'Dificultad: ' + difficulty, { fontSize: '32px', fill: '#000' });

            // Start game
            showStartScreen.call(this);
        }

        function update() {}

        function showStartScreen() {
            // Display start screen with difficulty selection
            this.add.text(200, 100, 'Minijuego de Memoria Musical', { fontSize: '48px', fill: '#000' }).setOrigin(0.5);

            this.easyButton = this.add.text(400, 200, 'Fácil', { fontSize: '32px', fill: '#00ff00' }).setOrigin(0.5).setInteractive();
            this.mediumButton = this.add.text(400, 300, 'Medio', { fontSize: '32px', fill: '#0000ff' }).setOrigin(0.5).setInteractive();
            this.hardButton = this.add.text(400, 400, 'Difícil', { fontSize: '32px', fill: '#ff0000' }).setOrigin(0.5).setInteractive();

            this.easyButton.on('pointerdown', () => setDifficulty.call(this, 'easy'));
            this.mediumButton.on('pointerdown', () => setDifficulty.call(this, 'medium'));
            this.hardButton.on('pointerdown', () => setDifficulty.call(this, 'hard'));
        }

        function setDifficulty(level) {
            difficulty = level;
            switch (level) {
                case 'easy':
                    intervalTime = 1000;
                    break;
                case 'medium':
                    intervalTime = 800;
                    break;
                case 'hard':
                    intervalTime = 600;
                    break;
            }

            this.difficultyText.setText('Dificultad: ' + level.charAt(0).toUpperCase() + level.slice(1));
            startNewRound.call(this);
        }

        function startNewRound() {
            isPlayerTurn = false;
            playerSequence = [];
            currentStep = 0;
            sequence.push(Phaser.Utils.Array.GetRandom(colors));
            animateSequence.call(this);
        }

        function animateSequence() {
            isAnimating = true;
            let index = 0;
            const interval = setInterval(() => {
                if (index >= sequence.length) {
                    clearInterval(interval);
                    isAnimating = false;
                    isPlayerTurn = true;
                    return;
                }

                flashButton.call(this, sequence[index]);
                playSound.call(this, sequence[index]);
                index++;
            }, intervalTime);
        }

        function flashButton(color) {
            const buttonMap = {
                red: this.redButton,
                green: this.greenButton,
                blue: this.blueButton,
                yellow: this.yellowButton
            };

            const originalColor = buttonMap[color].fillColor;
            buttonMap[color].setFillStyle(0xffffff);
            setTimeout(() => {
                buttonMap[color].setFillStyle(originalColor);
            }, 300);
        }

        function handlePlayerInput(color) {
            if (!isPlayerTurn || isAnimating) return;

            playSound.call(this, color);
            playerSequence.push(color);

            if (color === sequence[playerSequence.length - 1]) {
                if (playerSequence.length === sequence.length) {
                    score++;
                    this.scoreText.setText('Puntuación: ' + score);
                    startNewRound.call(this);
                }
            } else {
                gameOver.call(this);
            }
        }

        function playSound(color) {
            this.sound.play(color);
        }

        function gameOver() {
            this.add.text(400, 200, 'Game Over', { fontSize: '64px', fill: '#ff0000' }).setOrigin(0.5);
            this.add.text(400, 300, 'Puntuación Final: ' + score, { fontSize: '32px', fill: '#000' }).setOrigin(0.5);

            const restartButton = this.add.text(400, 400, 'Reiniciar', { fontSize: '32px', fill: '#00f' }).setOrigin(0.5).setInteractive();
            restartButton.on('pointerdown', () => {
                sequence = [];
                score = 0;
                this.scoreText.setText('Puntuación: ' + score);
                startNewRound.call(this);
            });
        }
    </script>
</body>
</html>
